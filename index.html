<!doctype html>
<!--
  Fichaje (PWA) — Smouj013
  Entrada / Pausa / Volver / Salida + Resumen + Export CSV
-->
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="color-scheme" content="dark light" />
  <meta name="theme-color" content="#0b0b10" />
  <meta name="description" content="App de fichaje: entrada/pausa/salida, resumen diario y exportación CSV." />

  <link rel="manifest" href="./manifest.webmanifest" />
  <link rel="stylesheet" href="./styles.css" />

  <title>Fichaje — Smouj013</title>
</head>

<body>
  <noscript>
    <div class="noscript">
      Necesitas JavaScript activado para usar esta app.
    </div>
  </noscript>

  <!-- Banner si el JS no llega a cargar -->
  <div class="jsfail" id="jsFail" hidden>
    ⚠️ No se ha cargado app.js (o ha fallado). Abre la consola (F12) y revisa errores.
    <div class="jsfail-sub">Comprueba que <b>app.js</b> está junto a <b>index.html</b> y que lo abres vía servidor (http://), no como file://</div>
  </div>

  <div class="app">
    <header class="topbar">
      <div class="brand">
        <div class="logo">⏱️</div>
        <div class="brandText">
          <div class="title" id="companyName">Fichaje</div>
          <div class="sub" id="employeeName">Sin usuario</div>
        </div>
      </div>

      <div class="topActions">
        <button class="btn ghost" id="btnSettings" type="button" title="Ajustes">⚙️</button>
      </div>
    </header>

    <main class="main">
      <section class="card statusCard">
        <div class="statusRow">
          <div class="statusLeft">
            <div class="statusLabel">Estado</div>
            <div class="statusValue" id="statusText">—</div>
            <div class="statusMeta" id="statusMeta">—</div>
          </div>

          <div class="timerBox">
            <div class="timerLabel">Tiempo</div>
            <div class="timerValue" id="timerText">00:00:00</div>
            <div class="timerHint" id="timerHint">—</div>
          </div>
        </div>

        <div class="actionRow">
          <button class="btn primary" id="btnIn" type="button">Entrar</button>
          <button class="btn warn" id="btnBreakStart" type="button">Pausa</button>
          <button class="btn warn" id="btnBreakEnd" type="button">Volver</button>
          <button class="btn danger" id="btnOut" type="button">Salir</button>
        </div>

        <div class="minorRow">
          <input class="input" id="noteInput" placeholder="Nota opcional (ej: reunión, médico…)" maxlength="120" />
          <button class="btn" id="btnAddNote" type="button">Añadir nota</button>
        </div>

        <div class="integrityRow" id="integrityRow" hidden>
          <span class="badge bad">⚠️ Integridad</span>
          <span class="integrityText" id="integrityText">Inconsistencia detectada.</span>
        </div>
      </section>

      <section class="card">
        <div class="cardHead">
          <div>
            <div class="cardTitle">Resumen</div>
            <div class="cardSub">Horas por día (trabajo y pausas)</div>
          </div>

          <div class="cardActions">
            <button class="btn" id="btnExport" type="button">Exportar CSV</button>
            <button class="btn ghost" id="btnClear" type="button">Borrar todo</button>
          </div>
        </div>

        <div class="days" id="days"></div>
      </section>

      <section class="card">
        <div class="cardHead">
          <div>
            <div class="cardTitle">Eventos</div>
            <div class="cardSub">Registro cronológico</div>
          </div>
          <div class="cardActions">
            <button class="btn ghost" id="btnExportRaw" type="button">Exportar eventos (CSV)</button>
          </div>
        </div>

        <div class="events" id="events"></div>
      </section>
    </main>

    <footer class="footer">
      <div class="footLeft">
        <span class="pill">PWA</span>
        <span class="pill">Offline</span>
        <span class="pill">Smouj013</span>
      </div>
      <div class="footRight">
        <button class="link" id="btnInstall" type="button" hidden>Instalar</button>
      </div>
    </footer>
  </div>

  <!-- Modal Ajustes -->
  <div class="modalBackdrop" id="settingsBackdrop" hidden></div>
  <div class="modal" id="settingsModal" hidden role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
    <div class="modalHead">
      <div>
        <div class="modalTitle" id="settingsTitle">Ajustes</div>
        <div class="modalSub">Empresa, empleado y opciones</div>
      </div>
      <button class="btn ghost" id="btnCloseSettings" type="button">✕</button>
    </div>

    <div class="modalBody">
      <label class="field">
        <span>Empresa</span>
        <input class="input" id="inpCompany" placeholder="Ej: Mi Empresa S.L." maxlength="40" />
      </label>

      <label class="field">
        <span>Empleado</span>
        <input class="input" id="inpEmployee" placeholder="Ej: Juan Pérez" maxlength="40" />
      </label>

      <label class="field row">
        <span>Solicitar PIN para exportar/borrar</span>
        <input type="checkbox" id="chkPin" />
      </label>

      <label class="field">
        <span>PIN (4–10 dígitos)</span>
        <input class="input" id="inpPin" inputmode="numeric" placeholder="••••" maxlength="10" />
        <div class="hint">Si activas el PIN, se pedirá para exportar o borrar.</div>
      </label>

      <label class="field row">
        <span>Guardar ubicación (opcional)</span>
        <input type="checkbox" id="chkGeo" />
      </label>

      <div class="smallNote">
        Importante: para PWA/offline, abre con <b>http://</b> (servidor), no con <b>file://</b>.
      </div>
    </div>

    <div class="modalFoot">
      <button class="btn ghost" id="btnCancelSettings" type="button">Cancelar</button>
      <button class="btn primary" id="btnSaveSettings" type="button">Guardar</button>
    </div>
  </div>

  <script defer src="./app.js"></script>

  <script>
    // Si la app no marca "ready" en ~1.5s, mostramos aviso
    setTimeout(() => {
      if (!document.documentElement.dataset.appReady) {
        document.getElementById("jsFail").hidden = false;
      }
    }, 1500);
  </script>
</body>
</html>
